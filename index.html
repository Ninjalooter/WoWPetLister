<html>
	<head>
		<script src="jquery.1.6.1.js"></script>
		<script>
			var g_spells = [];
			var g_items = [];
			
			var g_lootcard_spells = [
				// Example: 1, 4, 61234, 125123, 1245123
				68810, 49964, 40549, 93624, 96819, 96817, 45127, 30156, 45125, 68767
			];
			
			var g_blizcollectables_spells = [
				// Example: 1, 4, 61234, 125123, 1245123
				62456, 66030, 87344, 24988, 17708, 17707, 17709, 78381, 53082, 24696, 32298, 94070, 52615
			];
			
			var g_blizshop_spells = [
				// Example: 1, 4, 61234, 125123, 1245123
				69541, 99578, 69677, 95787, 69452, 75906, 95786, 69535, 68619, 69536
			];
			
			var g_limitededitions_spells = [
				// Example: 1, 4, 61234, 125123, 1245123
				61855, 54187, 48408, 45174, 45175, 27241, 66520, 23531, 23530, 40405, 55068, 69002, 48406, 51851, 65682, 28505, 64351
			];
			
		</script>
		<script src="pet_list.js"></script>
		<script>
			function parse_liste(sListe) {
				var result = [];
				
				var offset = 0;
				do {
					var pos = sListe.indexOf("[", offset);
					if ( pos < 0 ) break;
					
					var end = sListe.indexOf("]", pos + 1);
					var id = sListe.substring(pos + 1, end);
					result.push(parseInt(id));
					
					offset = end + 1;
				} while ( true);
				return result;
			}
			
			function filterSpellIdListe(aListe) {
				var spells = jQuery.grep(g_spells, function(spell, spellId) {
					return spell && jQuery.inArray(spellId, aListe) == -1;
				});
				return spells;
			}
			
			function wowhead_spellicon(spell) {
				if ( spell.icon ) {
					return "http://static.wowhead.com/images/wow/icons/small/" + spell.icon + ".jpg";  
				}
			}
			
			$(document).ready(function(){ 
				// Enrhich the g_spells array
				jQuery.each(g_spells, function(spellId, spell) {
					if ( !spell) 
						return;
					spell.id = spellId;
				});
				
				$("#btn_scan").click(function() {
					
					var list = $("#pet_list");
					var missingSpells = filterSpellIdListe(parse_liste(list.val()));
					
					// Filter loot card spells from g_lootcard_spells
					if ( $("#filter_lootcards").attr("checked") ) {
						missingSpells = jQuery.grep(missingSpells, function(spell, index) {
							return jQuery.inArray(spell.id, g_lootcard_spells) == -1;
						});
					}
					
					// Filter g_blizcollectables_spells
					if ( $("#filter_blizzcoll").attr("checked") ) {
						missingSpells = jQuery.grep(missingSpells, function(spell, index) {
							return jQuery.inArray(spell.id, g_blizcollectables_spells) == -1;
						});
					}
					
					// Filter g_blizshop_spells
					if ( $("#filter_blizzshop").attr("checked") ) {
						missingSpells = jQuery.grep(missingSpells, function(spell, index) {
							return jQuery.inArray(spell.id, g_blizshop_spells) == -1;
						});
					}
					
					// Filter g_limitededitions_spells
					if ( $("#filter_limited").attr("checked") ) {
						missingSpells = jQuery.grep(missingSpells, function(spell, index) {
							return jQuery.inArray(spell.id, g_limitededitions_spells) == -1;
						});
					}
					
					// Prepare output list
					var resultList = $("#result_list");
					var ul = $("<ol></ol>");
					resultList.empty().append("<h2>Your Missing Pets</h2>").append(ul);
					
					if ( missingSpells.length == 0 ) {
						ul.append("<li>Du hast alles!</li>");
					} else {
						jQuery.each(missingSpells, function(index, value) {
							var id = value.id;
							var name = value.name_dede;
							
							var li = $("<li></li>");
							var spellIcon = wowhead_spellicon(value);
							if (spellIcon) {
								var img = $("<img />");
								img.attr("border", "0");
								img.attr("src", spellIcon);
								li.append(img).append(" ");
							}
							
							li.append("<a href=\"http://de.wowhead.com/spell=" + id + "\">" + name + "</a>");
							if(jQuery.inArray(id, g_lootcard_spells) >= 0) {
								li.append(" - LOOTKARTE");
							}	

							if(jQuery.inArray(id, g_blizcollectables_spells) >= 0) {
								li.append(" - Blizzard Collectable");
							}			
							
							if(jQuery.inArray(id, g_blizshop_spells) >= 0) {
								li.append(" - Blizzard Shop");
							}
							
							if(jQuery.inArray(id, g_limitededitions_spells) >= 0) {
								li.append(" - Limited Edition");
							}
							
							ul.append(li);
						});
					}
					
					$WowheadPower.init();
				});
				
			});
		</script>
		<script type="text/javascript" src="http://static.wowhead.com/widgets/power.js"></script>
		
		<style>
			.center{
				margin:auto;
			}
			
			#header {
			}
			.content {
				text-align:center;
			}
			.footer {
				margin-top:30px;
				margin-bottom:20px;
				text-align:center;
			}
		</style>
	</head>
	<body>	
		<div style="width:600px" class="center">
			<div id="header">
				<img style="padding: 20pt 0px 0px 0pt;" title="WoW Pet Lister" src="WPL_Banner.png" alt="" width="600" height="100" />
			</div>			
			<div class="content">
				<b>How to Scan for Missing Pets:</b> <a href="howtoenglish.html">English</a> | <a href="howtodeutsch.html">Deutsch</a><br />
				<br />
				<textarea cols="40" rows="12" id="pet_list"></textarea> <br /> <br />
				<input type="checkbox" value="true" id="filter_lootcards" checked="checked" /><label for="filter_lootcards">Hide lootcard pets</label>
				<input type="checkbox" value="true" id="filter_limited" checked="checked" /><label for="filter_limited">Hide Limited Editions</label><br />
				<input type="checkbox" value="true" id="filter_blizzcoll" checked="checked" /><label for="filter_blizzcoll">Hide Blizzard Collectables</label>
				<input type="checkbox" value="true" id="filter_blizzshop" checked="checked" /><label for="filter_blizzshop">Hide Blizzard Shop</label><br /><br />
				<button id="btn_scan"><img alt="Click to list your missing pets." title="Scan!" style="padding: 0pt 0px 0px 0pt;" src="scan_button4.png"/></button><br />
			</div>
			
			<div id="result_list"></div>
			
			
			<div class="footer">
				Presented by <a href="http://ninjalooter.de/">Ninjalooter.de</a> | Database <a href="http://de.wowhead.com/">wowhead.com</a>
			</div>
			
		</div>
		
	</body>
</html>
	